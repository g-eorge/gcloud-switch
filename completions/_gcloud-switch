#compdef gcloud-switch gcloud-setup-adc

# Tab completion for gcloud-switch plugin

_gcloud_switch_configs() {
    local configs
    configs=(${(f)"$(find ~/.config/gcloud/configurations -name 'config_*' 2>/dev/null | xargs -I{} basename {} | sed 's/^config_//')"})
    _describe 'gcloud configurations' configs
}

_gcloud_scope_names() {
    local -a scopes
    scopes=(
        'bigquery:BigQuery'
        'bigquery.readonly:BigQuery read-only'
        'compute:Compute Engine'
        'compute.readonly:Compute Engine read-only'
        'datastore:Cloud Datastore'
        'devstorage.full_control:Cloud Storage full control'
        'devstorage.read_only:Cloud Storage read-only'
        'devstorage.read_write:Cloud Storage read/write'
        'drive:Google Drive'
        'drive.readonly:Google Drive read-only'
        'gmail.readonly:Gmail read-only'
        'gmail.send:Gmail send'
        'monitoring:Cloud Monitoring'
        'monitoring.read:Cloud Monitoring read-only'
        'pubsub:Pub/Sub'
        'spreadsheets:Google Sheets'
        'spreadsheets.readonly:Google Sheets read-only'
        'youtube.readonly:YouTube read-only'
        'youtube.upload:YouTube upload'
    )
    _describe 'scope' scopes
}

_gcloud-switch() {
    _arguments '1: :_gcloud_switch_configs'
}

_gcloud-setup-adc() {
    _arguments '--no-browser[Use remote login flow for headless sessions]' '1: :_gcloud_switch_configs' '*: :_gcloud_scope_names'
}

_gcloud-switch "$@"
